@model List<UsuarioSeguidoPerfil>

    <h2>Seguidos</h2>
@if (Model != null && Model.Any())
{
    @foreach (var seguido in Model)
    {
        <div class="seguidor-item" data-id-seguido="@seguido.IdUsuarioSeguido" data-id-seguidor="@seguido.IdUsuarioSeguidor">
            <img src="@seguido.ImagenSeguido" alt="@seguido.NombreSeguido" class="seguidor-avatar" />
                    <p>@seguido.NombreSeguido</p>


                <!-- Enlace al perfil del usuario seguido -->
                <a asp-controller="Usuarios" asp-action="PerfilUser" asp-route-idusuario="@seguido.IdUsuarioSeguido">
                    <img src="https://e7.pngegg.com/pngimages/649/536/png-clipart-crop-supply-computer-icons-blog-info-infographic-text.png" style="height:23px; width:23px" />
                </a>

                <!-- Botón para dejar de seguir -->
                @if (seguido.IdUsuarioSeguidor == Context.Session.GetInt32("IdUsuario"))
                {
                    <button class="btn btn-danger btn-sm dejar-de-seguir" style="background: none; border: none; padding: 0;">
                        <img src="https://w7.pngwing.com/pngs/36/901/png-transparent-cancel-disconnect-unfollow-user-block-unroll-unsubscribe-pinpoint-interface-i-icon-thumbnail.png" style="height:26px; width:26px" />
                    </button>
                }
        </div>
    }
}
else
{
    <p>No has seguido a ningún usuario aún.</p>
}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function() {
        // Manejar el clic del botón "Dejar de seguir"
        $(document).on('click', '.dejar-de-seguir', function(e) {
            e.preventDefault();
            var seguidorItem = $(this).closest('.seguidor-item');
            var idSeguido = seguidorItem.data('id-seguido');

            // Mostrar SweetAlert de confirmación
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás volver a seguir a este usuario a menos que lo hagas manualmente!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, dejar de seguir',
                cancelButtonText: 'Cancelar',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    // Hacer la petición POST para dejar de seguir
                    $.post('/Home/DejarDeSeguir', { idSeguido: idSeguido }, function() {
                        // Eliminar el usuario de la vista inmediatamente
                        seguidorItem.remove();

                        // Mostrar SweetAlert de éxito
                        Swal.fire(
                            'Eliminado',
                            'Has dejado de seguir a este usuario.',
                            'success'
                        );
                    }).fail(function() {
                        // Mostrar SweetAlert de error
                        Swal.fire(
                            'Error',
                            'Hubo un error al dejar de seguir al usuario.',
                            'error'
                        );
                    });
                }
            });
        });
    });
</script>